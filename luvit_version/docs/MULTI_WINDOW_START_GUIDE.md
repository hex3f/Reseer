# 多窗口启动指南

## 🚀 快速启动

双击 `start.bat` 即可启动所有服务器！

```bash
cd luvit_version
start.bat
```

## 📦 服务器架构

启动后会打开 **5 个独立窗口**，每个窗口运行一个服务器：

```
┌─────────────────────────────────────────────────────────┐
│                    start.bat (启动器)                    │
└─────────────────────────────────────────────────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌──────────────┐   ┌──────────────┐   ┌──────────────┐
│ 资源服务器    │   │ 登录IP服务器  │   │ 登录服务器    │
│ (32400)      │   │ (32401)      │   │ (1863)       │
│ 提供网页入口  │   │ 提供 ip.txt  │   │ 处理登录认证  │
└──────────────┘   └──────────────┘   └──────────────┘
        │                  │                  │
        └──────────────────┼──────────────────┘
                           │
        ┌──────────────────┴──────────────────┐
        │                                     │
        ▼                                     ▼
┌──────────────┐                     ┌──────────────┐
│ 游戏服务器    │                     │ 房间服务器    │
│ (5000)       │                     │ (5100)       │
│ 游戏逻辑     │                     │ 家园系统     │
│ 地图/战斗    │                     │ NoNo系统     │
└──────────────┘                     └──────────────┘
```

## 🎯 各服务器功能

### 1. 资源服务器 (Resource Server) - 端口 32400
- **功能**: 提供 HTTP 资源服务，游戏网页入口
- **访问**: http://127.0.0.1:32400/
- **重要性**: ⭐⭐⭐⭐⭐ 必须启动
- **窗口标题**: "资源服务器 - Resource Server"

### 2. 登录IP服务器 (Login IP Server) - 端口 32401
- **功能**: 提供 ip.txt 文件，告诉客户端登录服务器地址
- **访问**: http://127.0.0.1:32401/ip.txt
- **重要性**: ⭐⭐⭐⭐⭐ 必须启动
- **窗口标题**: "登录IP服务器 - Login IP Server"

### 3. 登录服务器 (Login Server) - 端口 1863
- **功能**: 处理用户登录认证，分配游戏服务器
- **协议**: TCP Socket
- **重要性**: ⭐⭐⭐⭐⭐ 必须启动
- **窗口标题**: "登录服务器 - Login Server"

### 4. 游戏服务器 (Game Server) - 端口 5000
- **功能**: 
  - 游戏主逻辑
  - 地图系统
  - 战斗系统
  - 精灵管理
  - 任务系统
- **协议**: TCP Socket
- **重要性**: ⭐⭐⭐⭐⭐ 必须启动
- **窗口标题**: "游戏服务器 - Game Server"

### 5. 房间服务器 (Room Server) - 端口 5100
- **功能**:
  - 家园系统
  - 家具管理
  - NoNo 系统
  - 房间装饰
- **协议**: TCP Socket
- **重要性**: ⭐⭐⭐⭐ 进入家园时需要
- **窗口标题**: "房间服务器 - Room Server"

## 🎮 使用流程

1. **启动服务器**
   ```bash
   双击 start.bat
   ```
   等待所有 5 个窗口打开（约 10 秒）

2. **访问游戏**
   ```
   打开浏览器访问: http://127.0.0.1:32400/
   ```

3. **登录游戏**
   - 输入任意用户名和密码
   - 首次登录会自动创建账号
   - 登录成功后进入游戏

4. **游戏中**
   - 在地图中移动、战斗 → 游戏服务器处理
   - 进入家园 → 房间服务器处理
   - NoNo 跟随/回家 → 房间服务器处理

## 💡 优势

### ✅ 独立性
- 每个服务器独立运行
- 一个服务器崩溃不影响其他服务器
- 可以单独重启某个服务器

### ✅ 可调试性
- 每个窗口显示独立的日志
- 容易定位问题所在的服务器
- 可以单独查看某个服务器的输出

### ✅ 可扩展性
- 未来可以将服务器部署到不同机器
- 可以轻松添加新的服务器类型
- 支持负载均衡

## ⚠️ 注意事项

### 数据同步
- **重要**: 每个服务器有独立的数据副本
- 游戏服务器和房间服务器各自维护 `users.json`
- 数据会自动保存（每 30 秒）
- 关闭服务器时会自动保存数据

### 启动顺序
建议按以下顺序启动（`start.bat` 已自动处理）：
1. 资源服务器
2. 登录IP服务器
3. 登录服务器
4. 游戏服务器
5. 房间服务器

### 关闭顺序
建议按以下顺序关闭：
1. 先关闭游戏服务器和房间服务器（让玩家先下线）
2. 再关闭登录服务器（停止新玩家登录）
3. 最后关闭资源服务器和登录IP服务器

### 端口占用
确保以下端口未被占用：
- 32400 (资源服务器)
- 32401 (登录IP服务器)
- 1863 (登录服务器)
- 5000 (游戏服务器)
- 5100 (房间服务器)

## 🔧 故障排除

### 问题1: 某个窗口立即关闭
**原因**: 端口被占用或启动失败
**解决**: 
1. 检查该窗口的错误信息
2. 确认端口未被占用
3. 单独运行该服务器查看详细错误

### 问题2: 无法访问网页
**原因**: 资源服务器未启动
**解决**:
1. 检查 "资源服务器 - Resource Server" 窗口是否打开
2. 确认端口 32400 未被占用
3. 尝试访问 http://127.0.0.1:32400/

### 问题3: 无法登录
**原因**: 登录服务器或登录IP服务器未启动
**解决**:
1. 检查 "登录服务器" 和 "登录IP服务器" 窗口
2. 确认端口 1863 和 32401 未被占用
3. 访问 http://127.0.0.1:32401/ip.txt 确认返回 "127.0.0.1:1863"

### 问题4: 进入家园失败
**原因**: 房间服务器未启动
**解决**:
1. 检查 "房间服务器 - Room Server" 窗口
2. 确认端口 5100 未被占用
3. 查看房间服务器日志

## 📊 监控和调试

### 查看日志
每个服务器窗口都会实时显示日志：
- 绿色 = 成功操作
- 黄色 = 警告信息
- 红色 = 错误信息
- 蓝色 = 一般信息

### 按 Enter 键
在任意服务器窗口按 Enter 键会打印分隔线，方便查看日志

### 数据保存
- 自动保存: 每 30 秒
- 手动保存: 关闭窗口时自动保存
- 保存位置: `luvit_version/users.json`

## 🆚 对比单窗口模式

### 单窗口模式 (reseer.lua)
```bash
luvit reseer.lua
```
- ✅ 简单，一个命令启动所有服务
- ✅ 数据共享，无需同步
- ❌ 一个错误可能导致全部崩溃
- ❌ 日志混在一起，难以调试

### 多窗口模式 (start.bat)
```bash
start.bat
```
- ✅ 独立运行，互不影响
- ✅ 日志分离，易于调试
- ✅ 可单独重启某个服务
- ⚠️ 数据独立，需要注意同步

## 🎯 推荐使用场景

### 使用单窗口模式 (reseer.lua)
- 快速测试
- 开发调试
- 个人单机游戏

### 使用多窗口模式 (start.bat)
- 生产环境
- 多人服务器
- 需要高可用性
- 需要独立调试各个服务

## 📝 总结

多窗口启动模式提供了更好的隔离性和可调试性，适合生产环境和需要高可用性的场景。每个服务器独立运行，一个服务器的问题不会影响其他服务器，让你的赛尔号私服更加稳定可靠！

现在就双击 `start.bat` 开始你的赛尔号之旅吧！🚀
